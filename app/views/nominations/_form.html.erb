<%= form_with(model: nomination, local: true, :html => {:multipart => true} ) do |form| %> 
  <div class="container-fluid" id="main-form">
      <div class='card'>
          <div class='card-header' data-background-color='blue'>
              <b>Add Nomination Information</b>
          </div>
          <div class='card-content'>
              <div class='row'>
                  <div class='col-md-12'>
                      <div class="form-group label">
                          <label class="control-label ">Select Award Type</label>
                          <% if params[:action] != "team_nomination" %>
                            <%= form.select :award_id, options_from_collection_for_select(@awards, 'id', 'title'), {}, {class: "form-control"}%>
                            <%= form.hidden_field :nomination_type, value: "individual"%>
                          <% else %>
                            <%= form.select :award_id, options_from_collection_for_select(@awards, 'id', 'title'), {}, {:disabled => true, class: "form-control"}%>
                            <%= form.hidden_field :award_id, :value => @award.id %>
                            <%= form.hidden_field :nomination_type, value: "team"%>
                          <% end %>
                      </div>
                  </div>
                  <div class='col-md-12'>
                      <div class="form-group label">
                        <%= form.fields_for :nominees do |s| %>
                          <label class="control-label ">Select Nominee</label>
                          <%#= s.select :user_id, options_from_collection_for_select(@users, 'id', "emp_code"), {include_hidden: false}, {:multiple => false, class: "form-control"}%>
                          <% if params[:action] == 'new'%>
                            <%= s.select :user_id, options_for_select(@users), {include_hidden: false}, {:multiple => false, class: "form-control"}%>
                          <% else %>
                            <%= s.select :user_id, options_for_select(@users), {include_hidden: false}, {:multiple => true, class: "form-control"}%>
                          <% end %>
                        <% end %>
                      </div>
                  </div>
                  <div class='col-md-6'>
                      <div class="form-group label">
                          <label class="control-label ">Nominator</label>
                          <%= form.hidden_field :nominator_id, value: current_user.id %>
                          <%= form.hidden_field :nominator_type, value: current_user.class.to_s %>
                          <input type='text' class='form-control disabled' disabled value='<%= current_user.employee.name %>'>
                      </div>
                  </div>
                  <div class='col-md-6'>
                      <div class="form-group label">
                          <label class="control-label ">Date</label>
                          <%= form.hidden_field :date, value: Date.today %>
                          <input type='text' class='form-control disabled' disabled value='<%= Date.today.strftime("%d-%m-%Y")%>'>
                      </div>
                  </div>
                  
                  <div class='col-md-12'>
                      <h5>Please select the answer of your choice based on following scale</h5>
                      <table class='table table-bordered infoTable'>
                          <tbody>
                              <tr>
                                  <td>Excellent</td><td>3</td>
                              </tr>
                                  <tr>
                                  <td>Very Good</td><td>2</td>
                              </tr><tr>
                                  <td>Good</td><td>1</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
                  <div class='col-md-12' id='aw1'>
                      <h5>Please answer the following</h5>
                      <table class='table table-bordered' id='rating-table'>
                          <%= form.fields_for :ratings do |rating| %>
                          <tr>
                              <td style='width: 50%'>
                                <%= rating.object.title %>
                                <%= rating.hidden_field :title, value: rating.object.title %>
                              </td>
                              <td>
                                  <div class="row">
                                      <div class='col-md-4'>
                                        Excellent (3 Pts) <%= rating.radio_button(:value, 3) %>
                                      </div>
                                      <div class='col-md-4'>
                                        Very Good (2 Pts) <%= rating.radio_button(:value, 2) %>
                                      </div>
                                      <div class='col-md-4'>
                                        Good (1 Pt) <%= rating.radio_button(:value, 1) %>
                                      </div>
                                  </div>
                              </td>
                          </tr>
                          <% end %>
                          <% unless params[:action] == "new" %>
                            <tr class='table_total_tr'>
                                <td style='width: 50%'>Total</td>
                                <td id='aw1_total'>0</td>
                            </tr>
                          <% end %>
                      </table>
                  </div>
                  
                  <div class='col-md-12'>
                    <h5>Click on success drivers demonstrated by the nominee</h5>
                    <div class='form-group'>
                    <div class="row">
                        <div class='col-md-4'>
                            <input type='checkbox' name='sd_innovativeness'> Innovativeness
                        </div>
                         <div class='col-md-4'>
                            <input type='checkbox' name='sd_agility'> Agility
                        </div>
                         <div class='col-md-4'>
                            <input type='checkbox' name='sd_responsiveness'> Responsiveness
                        </div>
                         <div class='col-md-4'>
                            <input type='checkbox' name='sd_performance_driven'>  Performance driven
                        </div>
                         <div class='col-md-4'>
                            <input type='checkbox' name='sd_ownership'>  Ownership
                        </div>
                        
                    </div>
                        
                    </div>
                  </div>
                  
                  <div class='col-md-12'>
                        <h5>Enter Justification</h5>
                        <div class="form-group label">
                            <%= form.text_area :justification %>
                            
                        </div>
                    </div>
                    <div class='col-md-12'>
                        <h5>Add Attachments</h5>
                        <%= form.fields_for :nomination_attachments do |p| %>
                            <div class="field">
                                <%#= p.label :attachment %><br>
                                <%= p.file_field :attachment %>
                            </div>
                        <% end %>
                    </div>
                    <div class='card-footer'>

                        <%= form.submit "Add Nomination", class: 'btn btn-success pull-right' %>
                    </div>
              </div>
          </div>
      </div>
  </div>
<% end %>
<script src="https://cdn.ckeditor.com/4.13.0/standard/ckeditor.js"></script>
<script>
    $(document).ready(function () {
        CKEDITOR.replace('nomination[justification]');
        $('select').select2();

        //Filling up ratings once
        var awardId = $(this).find(":selected").val();
        $('.hidden').show();
        $.get('/nominations/load_rating_form/' + awardId, function(data, status){
            $('#rating-table').html(data);
            calculate_total();
        });

        CKEDITOR.instances.nomination_justification.on("blur",function(e){
       var data = CKEDITOR.instances.nomination_justification.getData();
       if(data.split(' ').length < 50){
           alert("More Detailing Required");
           CKEDITOR.instances.nomination_justification.focus();
       }

       });
    });
    $('#nomination_award_id').on('change', function() {
        var awardId = $(this).find(":selected").val();
        $('.hidden').show();
        $.get('/nominations/load_rating_form/' + awardId, function(data, status){
            $('#rating-table').html(data);
            calculate_total();
        });
    });
    $('#nomination_nominees_attributes_0_user_id').on('change', function(){
        <% if params[:action] == 'team_nomination' %>
            if ($('#nomination_nominees_attributes_0_user_id').select2('data').length < 2) {
                // alert("Need at least one group");
                // event.preventDefault();
                $.notify("Need minimum two nominess","warning");
            }
        <% end %>
    })

    function calculate_total(){
        $('input[type=radio]').on("change", function() { 
            var total = 0;
            $('input[type="radio"]:checked').each(function() {
                total = total + parseInt($(this).val())
            }); 
            console.log(total)
            $("#aw1_total").html(total);
        });
    }
   
</script>